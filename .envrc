# direnv configuration for ros-launch-perf

# Auto-detect ROS 2 distro based on Ubuntu version
if [[ -f /etc/os-release ]]; then
    . /etc/os-release
    case "$VERSION_ID" in
        "22.04")
            ROS_DISTRO="humble"
            ;;
        "24.04")
            ROS_DISTRO="jazzy"
            ;;
        *)
            echo "Warning: Unknown Ubuntu version $VERSION_ID, defaulting to jazzy"
            ROS_DISTRO="jazzy"
            ;;
    esac
fi

# Source ROS 2 environment
if [[ -f /opt/ros/${ROS_DISTRO}/setup.sh ]]; then
    source /opt/ros/${ROS_DISTRO}/setup.sh
else
    echo "Warning: ROS 2 ${ROS_DISTRO} not found at /opt/ros/${ROS_DISTRO}/setup.sh"
fi

# Watch and source workspace setup if it exists
# The watch_file directive tells direnv to reload when the file changes
if [[ -f install/setup.sh ]]; then
    watch_file install/setup.sh
    source install/setup.sh
fi
