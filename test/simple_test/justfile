# Simple Test Suite for play_launch

# Variables
ros_distro := env_var_or_default('ROS_DISTRO', 'humble')

# Show help
default:
    @just --list

# Run pure_nodes.launch.xml from local launch directory
run-pure-nodes:
    #!/usr/bin/env bash
    set -e
    echo "Running pure nodes..."
    . /opt/ros/{{ros_distro}}/setup.bash
    . ../../install/setup.bash
    play_launch launch  launch/pure_nodes.launch.xml

# Run composition.launch.xml from local launch directory
run-composition:
    #!/usr/bin/env bash
    set -e
    echo "Running composition..."
    . /opt/ros/{{ros_distro}}/setup.bash
    . ../../install/setup.bash
    play_launch launch  launch/composition.launch.xml

# Run set_parameter.launch.xml from local launch directory
run-set-parameter:
    #!/usr/bin/env bash
    set -e
    echo "Running set_parameter..."
    . /opt/ros/{{ros_distro}}/setup.bash
    . ../../install/setup.bash
    play_launch launch  launch/set_parameter.launch.xml

# Run all.launch.xml from local launch directory
run-all:
    #!/usr/bin/env bash
    set -e
    echo "Running all tests combined..."
    . /opt/ros/{{ros_distro}}/setup.bash
    . ../../install/setup.bash
    play_launch launch  launch/all.launch.xml

# Generate plots from latest run
plot:
    @play_launch plot

# Dump composition.launch.xml using Rust parser
dump-rust:
    #!/usr/bin/env bash
    set -e
    echo "Dumping composition.launch.xml with Rust parser..."
    . /opt/ros/{{ros_distro}}/setup.bash
    . ../../install/setup.bash
    play_launch dump --output record_rust.json launch \
        --parser rust \
        launch/composition.launch.xml
    echo "✓ Rust parser dump complete: record_rust.json"

# Dump composition.launch.xml using Python parser
dump-python:
    #!/usr/bin/env bash
    set -e
    echo "Dumping composition.launch.xml with Python parser..."
    . /opt/ros/{{ros_distro}}/setup.bash
    . ../../install/setup.bash
    play_launch dump --output record_python.json launch \
        --parser python \
        launch/composition.launch.xml
    echo "✓ Python parser dump complete: record_python.json"

# Dump with both parsers
dump-both: dump-rust dump-python

# Compare Rust and Python parser outputs
compare-dumps:
    #!/usr/bin/env bash
    set -e
    if [ ! -f "record_rust.json" ]; then
        echo "ERROR: record_rust.json not found. Run 'just dump-rust' first."
        exit 1
    fi
    if [ ! -f "record_python.json" ]; then
        echo "ERROR: record_python.json not found. Run 'just dump-python' first."
        exit 1
    fi
    echo "Comparing Rust and Python parser outputs..."
    echo ""
    python3 ../../scripts/compare_records.py record_rust.json record_python.json
    echo ""
    echo "Comparison complete."

# Clean generated files
clean:
    #!/usr/bin/env bash
    set -e
    echo "Cleaning up..."
    rm -rf play_log record*.json
    echo "Cleanup complete"
