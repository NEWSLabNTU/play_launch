[profile.default]
slow-timeout = { period = "30s", terminate-after = 2 }
fail-fast = false

[profile.default.junit]
path = "junit.xml"
store-success-output = false
store-failure-output = true

# Autoware tests need longer timeouts
[[profile.default.overrides]]
filter = "binary(autoware)"
slow-timeout = { period = "60s", terminate-after = 2 }

# Smoke test needs extra time: dump ~5s + launch ~60s + settle 15s + analysis
[[profile.default.overrides]]
filter = "binary(autoware) & test(smoke_test)"
slow-timeout = { period = "90s", terminate-after = 2 }

[[profile.default.overrides]]
filter = "binary(simple_workspace)"
slow-timeout = { period = "60s", terminate-after = 2 }

[[profile.default.overrides]]
filter = "binary(sequential_loading) | binary(concurrent_loading) | binary(mixed_loading)"
slow-timeout = { period = "60s", terminate-after = 2 }

[[profile.default.overrides]]
filter = "binary(io_stress)"
slow-timeout = { period = "60s", terminate-after = 2 }

[[profile.default.overrides]]
filter = "binary(parallel_loading)"
slow-timeout = { period = "60s", terminate-after = 2 }

# Tests that create DDS participants (containers, clone(CLONE_VM) children,
# or full launch stacks) are serialized to avoid FastRTPS SHM port exhaustion.
# Retry once: clone(CLONE_VM) + DDS interactions are inherently racy
# (child death timing, SHM segment cleanup, ComponentEvent ordering).
[test-groups.isolated-container]
max-threads = 1

[[profile.default.overrides]]
filter = "binary(parallel_loading) & not test(dump)"
test-group = "isolated-container"
retries = 1

[[profile.default.overrides]]
filter = "binary(container_events) & test(crash|launch)"
test-group = "isolated-container"
retries = 1

[[profile.default.overrides]]
filter = "binary(autoware) & test(smoke_test)"
test-group = "isolated-container"

[profile.ci]
slow-timeout = { period = "30s", terminate-after = 2 }
fail-fast = true
